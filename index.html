<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’¸åŠ›çˆ±çš„å¤§å†’é™©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');

        :root {
            --pink: #ff71ce;
            --blue: #01cdfe;
            --black: #050505;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'ZCOOL KuaiLe', cursive;
            background-color: var(--black);
        }

        /* 1. é¦–é¡µï¼šä½¿ç”¨ä½ æä¾›çš„ç¬¬ä¸€å¼ å›¾ä½œä¸ºèƒŒæ™¯ */
        #start-page {
            position: absolute; width: 100%; height: 100%;
            background: url('bg1.png') no-repeat center center; /* è¯·ç¡®ä¿æ›¿æ¢ä¸ºä½ æœ¬åœ°æˆ–å›¾åºŠé“¾æ¥ */
            background-size: contain;
            display: flex; align-items: center; justify-content: center;
            z-index: 10;
        }
        #start-overlay {
            position: absolute; width: 100%; height: 100%;
            background: rgba(30, 30, 30, 0.7); /* åŠé€æ˜ç°è‰²é®ç½© */
            z-index: 11;
        }

        .ui-content { 
            position: relative; z-index: 12; text-align: center; 
            max-width: 85%; color: white;
        }

        h1 {
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            color: var(--pink);
            text-shadow: 3px 3px var(--blue), -1px -1px #fff;
            margin-bottom: 20px;
        }

        .story-text {
            font-size: 1.2rem; line-height: 1.6; color: #eee;
            margin-bottom: 30px; text-shadow: 1px 1px 2px #000;
        }

        .pixel-btn {
            padding: 15px 45px; font-size: 1.8rem; cursor: pointer;
            background: var(--pink); border: 4px solid #fff; color: #fff;
            box-shadow: 5px 5px 0px var(--blue); transition: 0.1s;
            border-radius: 8px;
        }
        .pixel-btn:active { transform: translate(3px, 3px); box-shadow: 2px 2px 0px var(--blue); }

        /* 2. æ¸¸æˆå†…è¿›åº¦æ˜¾ç¤º */
        #game-ui {
            position: absolute; top: 20px; left: 20px; z-index: 5;
            color: var(--pink); font-size: 1.5rem; text-shadow: 2px 2px #000;
            display: none;
        }

        #game-canvas{ 
    display: none; 
    /* ä½¿ç”¨ä½ ä¿å­˜çš„æˆ˜æ–—èƒŒæ™¯å›¾ */
    background: url('bg3.png') no-repeat center center; 
    background-size: cover; 
    cursor: crosshair; 
    
    /* å¦‚æœè§‰å¾—èƒŒæ™¯å¤ªäº®ï¼Œå¯ä»¥å–æ¶ˆä¸‹é¢è¿™è¡Œçš„æ³¨é‡Šæ¥å¢åŠ ä¸€å±‚æµ…ç™½è‰²é®ç½© */
    background-blend-mode: lighten; background-color: rgba(255, 255, 255, 0.2);
}

        /* 3. ç»“å±€é¡µé¢ */
        #end-page {
            position: absolute; width: 100%; height: 100%;
            background:url('bg2.png') no-repeat center center;
            background-size: contain;
            display: none; align-items: center; justify-content: center;
            z-index: 20;
        }
        .reward-card {
            background: rgba(255, 255, 255, 0.9); border: 5px solid var(--pink);
            padding: 25px; border-radius: 15px; text-align: center;
        }

        .hidden { display: none !important; }
        // åœ¨ <style> é‡ŒåŠ å…¥éœ‡åŠ¨æ•ˆæœ

@keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    10% { transform: translate(-1px, -2px) rotate(-1deg); }
    30% { transform: translate(3px, 2px) rotate(0deg); }
    100% { transform: translate(1px, -1px) rotate(0deg); }
}

    </style>
</head>
<body>

<div id="game-container">
    <div id="game-ui">å·²å‡»è´¥åšå£«èµ°ç‹—: <span id="score">0</span> / 15</div>

    <div id="start-page">
        <div id="start-overlay"></div>
        <div class="ui-content">
            <h1>æ’¸åŠ›çˆ±çš„å¤§å†’é™©</h1>
            <p class="story-text">
                åæ¶ˆæ¯ï¼å¦ˆå¦ˆç»™çˆ¸çˆ¸å‡†å¤‡çš„å·§å…‹åŠ›è¢«è±¹çŒ«çš®çš®æŠ¢èµ°äº†ï¼<br>
                å‹‡æ•¢å°çŒ«æ’¸åŠ›ï¼Œå¿«å‡»è´¥çš®çš®çš„åšå£«èµ°ç‹—ï¼Œå¤ºå›çˆ±çš„ç¤¼ç‰©ï¼
            </p>
            <button class="pixel-btn" onclick="startGame()">å¼€å§‹å†’é™©</button>
        </div>
    </div>

    <canvas id="game-canvas"></canvas>

    <div id="end-page">
        <div class="reward-card">
            <h2 style="color: var(--pink);">âœ¨ ä»»åŠ¡åœ†æ»¡å®Œæˆ âœ¨</h2>
            <p style="font-size: 1.5rem;">å¤ºå›å¥–åŠ±ï¼š<b>â€œçˆ±çš„çŒ«çŒ«å·§å…‹åŠ›â€ ğŸ«</b></p>
            <p>çˆ¸çˆ¸æ”¶åˆ°äº†çˆ±çš„ç¤¼ç‰©ï¼Œéå¸¸å¼€å¿ƒï¼</p>
            <button class="pixel-btn" style="font-size: 1rem;" onclick="location.reload()">å†æ¬¡æŒ‘æˆ˜</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    let gameActive = false;
    let score = 0;
    const TOTAL_ENEMIES = 15;

    let player = { x: 0, y: 0 };
    let bullets = [];
    let enemies = [];
    let lastBulletTime = 0;

    function initGame() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2 - 25;
        player.y = canvas.height - 120;
        score = 0;
        bullets = [];
        enemies = [];
    }

   /* function startGame() {
        document.getElementById('start-page').style.display = 'none';
        document.getElementById('game-ui').style.display = 'block';
        canvas.style.display = 'block';
        initGame();
        gameActive = true;
        requestAnimationFrame(gameLoop);*/
function startGame() {
    /* 1. å…ˆè§¦å‘ä¸€ä¸ªè§†è§‰å†²å‡»åŠ¨ç”»*/
    const overlay = document.getElementById('start-overlay');
    overlay.style.background = "white"; // é—ªç™½
    overlay.style.transition = "all 0.5s";
    
    // ç»™é¦–é¡µåŠ ä¸ªéœ‡åŠ¨æ•ˆæœ
    document.getElementById('start-page').style.animation = "shake 0.5s";

    // 2. å»¶è¿Ÿä¸€ç‚¹ç‚¹è¿›å…¥æ¸¸æˆï¼Œå¢åŠ ä»ªå¼æ„Ÿ
    setTimeout(() => {
        document.getElementById('start-page').classList.add('hidden');
        canvas.style.display = 'block';
        document.getElementById('game-ui').style.display = 'block';
        initGame();
        gameActive = true;
        requestAnimationFrame(gameLoop);
    }, 500);
}


    }

    // æ ¸å¿ƒå¾ªç¯ï¼šä½¿ç”¨é«˜æ•ˆçš„æ—¶é—´æˆ³å¤„ç†ï¼Œè§£å†³å¡é¡¿
    function gameLoop(time) {
        if (!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. æ’¸åŠ›å½¢è±¡
        drawLuli(player.x, player.y);

        // 2. è‡ªåŠ¨å‘å°„çˆ±å¿ƒå­å¼¹ (æ¯250msä¸€é¢—ï¼Œç¡®ä¿ä¸å¡é¡¿)
        if (time - lastBulletTime > 250) {
            bullets.push({ x: player.x + 20, y: player.y });
            lastBulletTime = time;
        }

        // 3. å­å¼¹é€»è¾‘
        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i];
            b.y -= 7; // å­å¼¹é€Ÿåº¦
            drawHeart(b.x, b.y, 8);
            if (b.y < -20) bullets.splice(i, 1);
        }

        // 4. ç”Ÿæˆåšå£«èµ°ç‹—
        if (Math.random() < 0.02) {
            enemies.push({ x: Math.random() * (canvas.width - 50), y: -60 });
        }

        // 5. èµ°ç‹—é€»è¾‘ä¸ç¢°æ’
        for (let i = enemies.length - 1; i >= 0; i--) {
            let e = enemies[i];
            e.y += 2.5; // æ•Œäººä¸‹è½é€Ÿåº¦
            drawDoctor(e.x, e.y);

            // ç¢°æ’æ£€æµ‹
            for (let j = bullets.length - 1; j >= 0; j--) {
                let b = bullets[j];
                if (b.x > e.x && b.x < e.x + 40 && b.y > e.y && b.y < e.y + 50) {
                    enemies.splice(i, 1);
                    bullets.splice(j, 1);
                    score++;
                    scoreEl.innerText = score;
                    if (score >= TOTAL_ENEMIES) winGame();
                    break;
                }
            }
            if (e.y > canvas.height) enemies.splice(i, 1);
        }

        requestAnimationFrame(gameLoop);
    }

    function drawHeart(x, y, size) {
        ctx.fillStyle = "#ff71ce";
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.bezierCurveTo(x-size, y-size, x-size*1.5, y+size, x, y+size*1.5);
        ctx.bezierCurveTo(x+size*1.5, y+size, x+size, y-size, x, y);
        ctx.fill();
    }

    function drawDoctor(x, y) {
        ctx.fillStyle = "#000"; ctx.fillRect(x+5, y-10, 30, 10); // å¸½å­
        ctx.fillRect(x-5, y-15, 50, 5);
        ctx.fillStyle = "#ffdbac"; ctx.fillRect(x+10, y, 20, 20); // è„¸
        ctx.fillStyle = "#fff"; ctx.fillRect(x+5, y+20, 30, 25); // ç™½å¤§è¤‚
    }

    function drawLuli(x, y) {
        ctx.fillStyle = "#c19a6b"; ctx.fillRect(x, y, 50, 40); // èº«ä½“
        ctx.fillRect(x+5, y-15, 15, 15); ctx.fillRect(x+30, y-15, 15, 15); // è€³æœµ
    }

    // äº¤äº’ï¼šå…¨å¹³å°æ”¯æŒ
    window.addEventListener('mousemove', (e) => { player.x = e.clientX - 25; });
    window.addEventListener('touchmove', (e) => { 
        player.x = e.touches[0].clientX - 25;
        e.preventDefault(); 
    }, {passive: false});

    function winGame() {
        gameActive = false;
        canvas.style.display = 'none';
        document.getElementById('game-ui').style.display = 'none';
        document.getElementById('end-page').style.display = 'flex';
    }
</script>
</body>

</html>

